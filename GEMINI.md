# GEMINI.md — Project Context for AI Assistants

## Project Overview

This is a **Spring Boot multi-module Maven project** focused on studying patterns for handling large-scale data (millions of records) efficiently. The project currently has one module:

| Module | Description |
|---|---|
| `table-with-million-records` | REST API demonstrating efficient querying of large PostgreSQL tables using offset-based pagination and cursor-based pagination |

---

## Technology Stack

| Layer | Technology | Version |
|---|---|---|
| Language | Java | 25 |
| Framework | Spring Boot | 4.0.3 |
| Database | PostgreSQL | 42.7.3 |
| ORM | Spring Data JPA / Hibernate | via Spring Boot |
| Migrations | Flyway | 11.20.0 |
| API Spec | OpenAPI Generator (spring) | 7.17.0 |
| API Docs | SpringDoc OpenAPI (Swagger UI) | 2.8.14 |
| Mapping | MapStruct | 1.6.3 |
| Boilerplate | Lombok | 1.18.42 |
| Formatting | Spotless + Google Java Format (AOSP) | 2.44.4 / 1.26.0 |
| Build | Maven | — |

---

## Project Structure

```
com.springboot.4.project/          ← root (parent POM)
├── pom.xml                        ← parent pom, manages shared dependencies & plugins
├── GEMINI.md
└── table-with-million-records/    ← child module
    ├── pom.xml
    └── src/
        ├── main/
        │   ├── java/com/springboot/project/
        │   │   └── Main.java
        │   └── resources/
        │       ├── application.yaml
        │       ├── openapi/
        │       │   └── open-api.yaml       ← API contract (code-first from spec)
        │       └── db/migration/
        │           └── V1_0_*__initial_table.sql  ← seeds 10M transactions + 200K bank accounts
        └── generated/              ← auto-generated by openapi-generator-maven-plugin (gitignored via target)
```

---

## Database Schema

Three main tables managed by Flyway migrations:

- **`login_user`** — application users with roles
- **`bank_account`** — 200,000 seeded accounts (SAVINGS / CURRENT, statuses: ACTIVE / INACTIVE / CLOSED)
- **`transaction_detail`** — 10,000,000 seeded transactions linked to bank accounts

Sequences used:
- `transaction_number_seq` — generates `TRN000...` formatted transaction numbers
- `sequence_number` — numeric sequence for transaction ordering
- `bank_account_sequence_number` — numeric sequence for account ordering

---

## API Endpoints

Base URL: `/api`

| Tag | Method | Path | Description |
|---|---|---|---|
| authentication | GET | `/private-app/actions/authenticate` | Redirect login |
| authentication | GET | `/private-app/actions/refresh-token` | Refresh token redirect |
| login-user | GET | `/private-app/users/actions/current` | Get current logged-in user |
| transaction | POST | `/private-app/transactions/actions/filter` | Filter transactions (offset pagination) |
| transaction | POST | `/private-app/transactions/actions/filter-cursor` | Filter transactions (cursor pagination) |
| bank-account | POST | `/private-app/bank-accounts/actions/filter` | Filter bank accounts (offset pagination) |
| bank-account | POST | `/private-app/bank-accounts/actions/filter-cursor` | Filter bank accounts (cursor pagination) |

Swagger UI is available at: `http://localhost:7070/swagger-ui/index.html`

---

## Build & Run

### Prerequisites

- Java 25+
- Maven 3.9+
- PostgreSQL running locally on port `5432`
  - Database: `postgres`
  - Username: `root`
  - Password: `password`

### Common Commands

```bash
# Clean and compile (also runs Spotless formatting check)
mvn clean compile

# Run tests
mvn test

# Package (skip tests)
mvn clean package -DskipTests

# Apply Spotless formatting
mvn spotless:apply

# Check Spotless formatting
mvn spotless:check

# Clean generated sources
mvn clean  # maven-clean-plugin also deletes src/generated/
```

### Running the Application

```bash
cd table-with-million-records
mvn spring-boot:run
```

Server starts on **port 7070**.

### Database Migration

Flyway runs automatically on startup. The initial migration seeds:
- **10 million** random `transaction_detail` rows (5-year date range)
- **200,000** random `bank_account` rows

> ⚠️ The first startup migration can take several minutes due to the large data seed.

---

## Code Generation

The OpenAPI generator plugin generates interfaces and models from `open-api.yaml` into `src/generated/java/`:
- API interfaces → `com.springboot.project.generated.api`
- Models → `com.springboot.project.generated.model` (suffix: `model`)

Generated code is cleaned on every `mvn clean` cycle and regenerated on compile. **Do not manually edit files in `src/generated/`.**

---

## Code Style & Conventions

- **Formatter**: Google Java Format (**AOSP** style, 4-space indent)
- **Spotless** enforces formatting on `src/main/java` and `src/test/java`
- A **pre-commit Git hook** (`hooks/pre-commit`) is installed by `git-build-hook-maven-plugin` to enforce formatting before commits
- **MapStruct** is used for DTO ↔ entity mapping — always annotate mappers with `@Mapper`
- **Lombok** is used to reduce boilerplate — prefer `@Data`, `@Builder`, `@RequiredArgsConstructor` as appropriate

### Annotation Processor Order (important)

The compiler plugin annotation processor path order must be: **MapStruct → Lombok → lombok-mapstruct-binding → spring-boot-configuration-processor**. This order ensures MapStruct processes Lombok-generated getters/setters correctly.

---

## Key Design Patterns

- **OpenAPI-first**: API contracts are defined in `open-api.yaml`; server-side interfaces are generated — implement the delegate pattern
- **Offset pagination** vs **Cursor pagination**: Both strategies are exposed for benchmarking performance on large datasets
- **Flyway migrations**: Versioned SQL files in `src/main/resources/db/migration/`

---

## Environment Configuration

`src/main/resources/application.yaml`:

```yaml
server:
  port: "7070"
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/postgres
    username: root
    password: password
  jpa:
    show-sql: true
    generate_statistics: true
  flyway:
    enabled: true
    baseline-on-migrate: true
```
